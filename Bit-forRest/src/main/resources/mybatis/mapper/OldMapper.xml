<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.mvc.forrest.dao.oldDao">
<!--namespace: 이 mapper.xml과 매핑될 mapper.java(인터페이스)를 의미함 -->


<resultMap id="oldSelectMap" type="old">
   <!-- result property="필드" column="테이블" -->
	<result property="oldNo"	column="oldNo"		jdbcType="INTEGER"/>
	<result property="userId"	column="userId"		jdbcType="VARCHAR"/>
	<result property="oldPrice"	column="oldPrice"		jdbcType="INTEGER"/>
	<result property="oldTitle"	column="oldTitle"		jdbcType="VARCHAR"/>
	<result property="oldDetail"	column="oldDetail"		jdbcType="INTEGER"/>
	<result property="oldDate"	column="oldDate"		jdbcType="TIMESTAMP"/>
	<result property="oldView"	column="oldView"		jdbcType="INTEGER"/>
	<result property="category"	column="category"		jdbcType="VARCHAR"/>
	<result property="oldState"	column="oldState"		jdbcType="BOOLEAN"/>
</resultMap>

<!-- SQL : INSERT  -->
<insert		id="addOld"		parameterType="old">
	INSERT
	INTO OLD(oldNo, userId, oldPrice, oldTitle, oldDetail, oldDate, oldView, category, oldState)
	values (NULL, #{userId},#{oldPrice},#{oldTitle},#{oldDetail},CURRENT_TIMESTAMP,#{oldView},#{category},#{oldState})
</insert>

 <!-- SQL : DELETE -->
<delete		id="deleteOld"		parameterType="int">
	DELETE
	FROM OLD
	WHERE oldNo = #{oldNo}
	</delete>

<!-- SQL : SELECT ONE -->
<select 	id="getOld"	parameterType="int"	resultMap="oldSelectMap">
	SELECT *
	FROM OLD
	WHERE oldNo = #{oldNo}
	 </select>

 <!-- SQL : UPDATE -->
 <update	id="updateOld"		parameterType="old" >
 	update OLD
 	<set>
 		oldPrice = #{oldPrice},
 		oldTitle = #{oldTitle},
 		oldDetail = #{oldDetail},
 		category = #{category},
 		oldState = #{oldState}

 	</set>
 	WHERE oldNo = #{oldNo}
 </update>

<!-- SQL : SELECT LIST -->
<select id="getOldList"	parameterType="search"	resultMap="oldSelectMap" >
	SELECT *
	FROM ( SELECT inner_table.* , ROWNUM AS row_seq
								FROM (SELECT o.oldNo, o.oldImg, o.oldTitle, o.oldPrice, o.oldDate, u.userId, oL.likeNo
										FROM old o, oldLike oL

										<where> o.oldTitle = #{serachOldTitle}

										<if test="searchKeyword != null">
											oldTitle LIKE '%'||${searchKeyword}||'%'
										</if>

										</where>
										ORDER BY o.oldDate DESC) inner_table
							WHERE ROWNUM &lt;= #{endRowNum} )

	WHERE row_seq BETWEEN #{startRowNum} AND #{endRowNum}

</select>

<select id="getTotalCount"	parameterType="search"	resultType="int">
SELECT *
FROM old

</select>



</mapper>